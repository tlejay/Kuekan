<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Preview</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #4F46E5;
            --primary-light: #818CF8;
            --bg: #FAFAFA;
            --card-bg: #FFFFFF;
            --text: #1F2937;
            --text-muted: #6B7280;
            --border: #E5E7EB;
            --success: #10B981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans Thai', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.8;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .subtitle {
            font-size: 13px;
            color: var(--text-muted);
            padding: 4px 12px;
            background: var(--bg);
            border-radius: 4px;
        }

        .download-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .download-btn:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .download-btn svg {
            flex-shrink: 0;
        }

        /* Main Content */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 100px 24px 60px;
        }

        .content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 48px 56px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        /* Markdown Styles */
        .content h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
            padding-bottom: 16px;
            border-bottom: 3px solid var(--primary);
        }

        .content h2 {
            font-size: 24px;
            font-weight: 600;
            margin-top: 48px;
            margin-bottom: 20px;
            color: var(--text);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .content h3 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 12px;
            color: var(--text);
        }

        .content h4 {
            font-size: 16px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 8px;
            color: var(--text-muted);
        }

        .content p {
            margin-bottom: 16px;
            color: var(--text);
        }

        .content ul,
        .content ol {
            margin-bottom: 16px;
            padding-left: 24px;
        }

        .content li {
            margin-bottom: 8px;
        }

        .content strong {
            font-weight: 600;
            color: var(--text);
        }

        .content em {
            font-style: italic;
        }

        .content blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 20px;
            margin: 20px 0;
            color: var(--text-muted);
            font-style: italic;
            background: var(--bg);
            padding: 16px 20px;
            border-radius: 0 8px 8px 0;
        }

        .content code {
            background: var(--bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
        }

        .content pre {
            background: #1F2937;
            color: #F9FAFB;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }

        .content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
            font-size: 14px;
        }

        .content th {
            background: var(--primary);
            color: white;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
        }

        .content th:first-child {
            border-radius: 8px 0 0 0;
        }

        .content th:last-child {
            border-radius: 0 8px 0 0;
        }

        .content td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .content tr:hover td {
            background: var(--bg);
        }

        .content tr:last-child td:first-child {
            border-radius: 0 0 0 8px;
        }

        .content tr:last-child td:last-child {
            border-radius: 0 0 8px 0;
        }

        .content hr {
            border: none;
            border-top: 2px solid var(--border);
            margin: 40px 0;
        }

        .content a {
            color: var(--primary);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        .content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        .content aside {
            background: linear-gradient(135deg, #EEF2FF 0%, #E0E7FF 100%);
            border-left: 4px solid var(--primary);
            padding: 20px 24px;
            margin: 24px 0;
            border-radius: 0 12px 12px 0;
            font-size: 14px;
        }

        .content aside p {
            margin-bottom: 8px;
        }

        .content aside p:last-child {
            margin-bottom: 0;
        }

        .content aside strong {
            color: var(--primary);
        }

        .content aside ul,
        .content aside ol {
            margin-bottom: 8px;
            padding-left: 20px;
        }

        .content aside li {
            margin-bottom: 4px;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Error State */
        .error {
            background: #FEF2F2;
            color: #DC2626;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 13px;
        }

        /* Mermaid Diagram Styles */
        .mermaid {
            background: var(--bg);
            padding: 24px;
            border-radius: 8px;
            margin: 24px 0;
            text-align: center;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
        }

        /* Print Styles */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }

            .header {
                display: none;
            }

            .container {
                padding: 0;
                max-width: 100%;
            }

            .content {
                box-shadow: none;
                padding: 0;
            }

            .content th {
                background: var(--primary) !important;
                color: white !important;
            }

            .content aside {
                background: #EEF2FF !important;
            }

            .footer {
                display: none;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-left">
            <span class="logo" id="logo"></span>
            <span class="subtitle" id="subtitle"></span>
        </div>
        <button class="download-btn" onclick="downloadPDF()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            Download as PDF
        </button>
    </header>

    <main class="container">
        <div class="content" id="content">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading markdown...</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p id="footer-text"></p>
    </footer>

    <script>
        // =====================================================
        // CONFIG - à¹à¸à¹‰à¹„à¸‚à¸•à¸£à¸‡à¸™à¸µà¹‰à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¸à¸±à¸šà¹‚à¸›à¸£à¹€à¸ˆà¸„à¸­à¸·à¹ˆà¸™
        // =====================================================
        const CONFIG = {
            PROJECT_NAME: 'KueKan',
            COMPANY_NAME: 'Digitalmedia Outsource Solution',
            COMPANY_FULL: 'Digitalmedia Outsource Solution Co., Ltd.',
            MARKDOWN_FILE: 'Proposal_KueKan_PAO_NCC_McKinsey-Shorten.md',
            REFRESH_INTERVAL: 3000, // milliseconds
        };
        // =====================================================

        let lastContent = '';
        let refreshTimer = null;
        let mermaidCounter = 0;

        // Initialize page elements from config
        function initPage() {
            document.title = `${CONFIG.PROJECT_NAME} - Document Preview`;
            document.getElementById('logo').textContent = CONFIG.PROJECT_NAME;
            document.getElementById('subtitle').textContent = `Document preview by ${CONFIG.COMPANY_NAME}`;
            document.getElementById('footer-text').textContent = `${CONFIG.PROJECT_NAME} Document Preview | ${CONFIG.COMPANY_FULL}`;
        }

        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'IBM Plex Sans Thai, Inter, sans-serif'
        });

        // Custom renderer for mermaid code blocks
        const renderer = new marked.Renderer();
        const originalCodeRenderer = renderer.code.bind(renderer);

        renderer.code = function (code, language) {
            // Handle both object format (newer marked) and string format (older marked)
            let codeText = typeof code === 'object' ? code.text : code;
            let lang = typeof code === 'object' ? code.lang : language;

            if (lang === 'mermaid') {
                mermaidCounter++;
                return `<div class="mermaid" id="mermaid-${mermaidCounter}">${codeText}</div>`;
            }
            return originalCodeRenderer(code, language);
        };

        // Configure marked options
        marked.setOptions({
            breaks: true,
            gfm: true,
            renderer: renderer
        });

        function downloadPDF() {
            window.print();
        }

        // Emoji shortcode mapping
        const emojiMap = {
            ':warning:': 'âš ï¸', ':bulb:': 'ğŸ’¡', ':info:': 'â„¹ï¸', ':note:': 'ğŸ“',
            ':tip:': 'ğŸ’¡', ':important:': 'â—', ':check:': 'âœ…', ':x:': 'âŒ',
            ':star:': 'â­', ':heart:': 'â¤ï¸', ':fire:': 'ğŸ”¥', ':rocket:': 'ğŸš€',
            ':thumbsup:': 'ğŸ‘', ':thumbsdown:': 'ğŸ‘', ':clap:': 'ğŸ‘', ':pray:': 'ğŸ™',
            ':eyes:': 'ğŸ‘€', ':point_right:': 'ğŸ‘‰', ':point_left:': 'ğŸ‘ˆ',
            ':point_up:': 'ğŸ‘†', ':point_down:': 'ğŸ‘‡', ':hand:': 'âœ‹',
            ':chart:': 'ğŸ“Š', ':chart_up:': 'ğŸ“ˆ', ':chart_down:': 'ğŸ“‰',
            ':money:': 'ğŸ’°', ':dollar:': 'ğŸ’µ', ':bag:': 'ğŸ’¼', ':gift:': 'ğŸ',
            ':trophy:': 'ğŸ†', ':medal:': 'ğŸ…', ':crown:': 'ğŸ‘‘', ':gem:': 'ğŸ’',
            ':lock:': 'ğŸ”’', ':unlock:': 'ğŸ”“', ':key:': 'ğŸ”‘', ':shield:': 'ğŸ›¡ï¸',
            ':gear:': 'âš™ï¸', ':wrench:': 'ğŸ”§', ':hammer:': 'ğŸ”¨', ':tools:': 'ğŸ› ï¸',
            ':link:': 'ğŸ”—', ':pin:': 'ğŸ“Œ', ':bookmark:': 'ğŸ”–', ':tag:': 'ğŸ·ï¸',
            ':calendar:': 'ğŸ“…', ':clock:': 'ğŸ•', ':hourglass:': 'â³', ':alarm:': 'â°',
            ':phone:': 'ğŸ“±', ':email:': 'ğŸ“§', ':inbox:': 'ğŸ“¥', ':outbox:': 'ğŸ“¤',
            ':file:': 'ğŸ“„', ':folder:': 'ğŸ“', ':clipboard:': 'ğŸ“‹', ':memo:': 'ğŸ“',
            ':pencil:': 'âœï¸', ':pen:': 'ğŸ–Šï¸', ':book:': 'ğŸ“–', ':books:': 'ğŸ“š',
            ':mag:': 'ğŸ”', ':bulb:': 'ğŸ’¡', ':battery:': 'ğŸ”‹', ':plug:': 'ğŸ”Œ',
            ':computer:': 'ğŸ’»', ':desktop:': 'ğŸ–¥ï¸', ':keyboard:': 'âŒ¨ï¸', ':mouse:': 'ğŸ–±ï¸',
            ':globe:': 'ğŸŒ', ':earth:': 'ğŸŒ', ':sun:': 'â˜€ï¸', ':moon:': 'ğŸŒ™',
            ':cloud:': 'â˜ï¸', ':rain:': 'ğŸŒ§ï¸', ':snow:': 'â„ï¸', ':zap:': 'âš¡',
            ':smile:': 'ğŸ˜Š', ':grin:': 'ğŸ˜', ':laugh:': 'ğŸ˜‚', ':wink:': 'ğŸ˜‰',
            ':cool:': 'ğŸ˜', ':think:': 'ğŸ¤”', ':sad:': 'ğŸ˜¢', ':angry:': 'ğŸ˜ ',
            ':party:': 'ğŸ‰', ':tada:': 'ğŸ‰', ':confetti:': 'ğŸŠ', ':balloon:': 'ğŸˆ',
            ':100:': 'ğŸ’¯', ':ok:': 'ğŸ‘Œ', ':wave:': 'ğŸ‘‹', ':muscle:': 'ğŸ’ª',
            ':arrow_right:': 'â¡ï¸', ':arrow_left:': 'â¬…ï¸', ':arrow_up:': 'â¬†ï¸', ':arrow_down:': 'â¬‡ï¸',
            ':plus:': 'â•', ':minus:': 'â–', ':multiply:': 'âœ–ï¸', ':divide:': 'â—',
            ':question:': 'â“', ':exclamation:': 'â—', ':bangbang:': 'â€¼ï¸',
            ':recycle:': 'â™»ï¸', ':white_check_mark:': 'âœ…', ':negative_squared_cross_mark:': 'â',
            ':green_circle:': 'ğŸŸ¢', ':red_circle:': 'ğŸ”´', ':yellow_circle:': 'ğŸŸ¡', ':blue_circle:': 'ğŸ”µ',
            ':target:': 'ğŸ¯', ':dart:': 'ğŸ¯', ':game:': 'ğŸ®', ':dice:': 'ğŸ²',
            ':user:': 'ğŸ‘¤', ':users:': 'ğŸ‘¥', ':building:': 'ğŸ¢', ':house:': 'ğŸ ',
            ':car:': 'ğŸš—', ':bus:': 'ğŸšŒ', ':train:': 'ğŸš†', ':plane:': 'âœˆï¸',
            ':ship:': 'ğŸš¢', ':bike:': 'ğŸš²', ':walking:': 'ğŸš¶', ':running:': 'ğŸƒ'
        };

        function processEmojis(text) {
            let result = text;
            for (const [code, emoji] of Object.entries(emojiMap)) {
                result = result.split(code).join(emoji);
            }
            return result;
        }

        function processAsideMarkdown(html) {
            // Process <aside> tags to render markdown inside them
            const asideRegex = /<aside>([\s\S]*?)<\/aside>/gi;
            return html.replace(asideRegex, (match, content) => {
                // Parse markdown inside aside
                let parsedContent = marked.parse(content.trim());
                // Process emoji shortcodes
                parsedContent = processEmojis(parsedContent);
                return `<aside>${parsedContent}</aside>`;
            });
        }

        async function renderMermaidDiagrams() {
            try {
                // Find all mermaid divs and render them
                const mermaidDivs = document.querySelectorAll('.mermaid');
                for (const div of mermaidDivs) {
                    const id = div.id;
                    const graphDefinition = div.textContent;
                    div.innerHTML = ''; // Clear content before rendering
                    const { svg } = await mermaid.render(id + '-svg', graphDefinition);
                    div.innerHTML = svg;
                }
            } catch (error) {
                console.error('Mermaid rendering error:', error);
            }
        }

        async function loadMarkdown() {
            try {
                // Add cache-busting parameter
                const response = await fetch(CONFIG.MARKDOWN_FILE + '?t=' + Date.now());

                if (!response.ok) {
                    throw new Error('Failed to load file: ' + response.status);
                }

                const markdown = await response.text();

                // Only update if content changed
                if (markdown !== lastContent) {
                    lastContent = markdown;
                    mermaidCounter = 0; // Reset counter for new render
                    let html = marked.parse(markdown);

                    // Process markdown inside <aside> tags
                    html = processAsideMarkdown(html);

                    document.getElementById('content').innerHTML = html;

                    // Render mermaid diagrams after content is loaded
                    await renderMermaidDiagrams();
                }
            } catch (error) {
                console.error('Error loading markdown:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <h3>Error Loading File</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 12px; font-size: 13px;">
                            Make sure you're running this through a local web server.<br>
                            Try: <code>python3 -m http.server 8000</code> or use VS Code Live Server
                        </p>
                    </div>
                `;
            }
        }

        // Initialize page
        initPage();

        // Initial load
        loadMarkdown();

        // Auto-refresh
        refreshTimer = setInterval(loadMarkdown, CONFIG.REFRESH_INTERVAL);

        // Keyboard shortcut: Cmd/Ctrl + R to refresh
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 'r') {
                e.preventDefault();
                loadMarkdown();
            }
        });
    </script>
</body>

</html>